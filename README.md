# Kotlin Client-Server

## Описание проекта
Клиент‑серверное приложение на Kotlin, работающее по UDP, для управления коллекцией объектов `HumanBeing`. Клиент отправляет команды на сервер в формате JSON, сервер выполняет операции с коллекцией и возвращает ответ. Данные коллекции сохраняются в PostgreSQL.

## Что делает программа
- Хранит коллекцию `HumanBeing` на сервере и предоставляет доступ к ней через команды.
- Поддерживает авторизацию/регистрацию пользователей.
- Обрабатывает команды интерактивно в консоли клиента и через выполнение скриптов.
- Сохраняет/читает данные из базы PostgreSQL.

## Основные команды
- `help` — вывод списка команд.
- `info` — информация о коллекции.
- `show` — показать элементы коллекции.
- `add`, `add_if_max` — добавить элемент.
- `update`, `remove_by_id`, `remove_first`, `remove_head`, `clear` — управление элементами.
- `print_ascending` — вывести элементы по возрастанию.
- `count_by_minutes_of_waiting`, `count_less_than_mood` — статистика.
- `execute_script` — выполнить команды из файла.
- `exit` — завершить клиент.

## Архитектура
- **Client-maven** — консольный клиент, ввод команд, сериализация в JSON и отправка по UDP.
- **Server-maven** — сервер, обработка команд, работа с БД, хранение коллекции в памяти.

## Технологии
- Kotlin
- Maven
- Gson (JSON)
- UDP (DatagramSocket)
- PostgreSQL + JDBC
- java.security.MessageDigest (SHA‑512)
- java.util.concurrent (ExecutorService, ReadWriteLock)

## Как общаются клиент и сервер
- Транспорт: UDP (DatagramSocket/DatagramPacket).
- Формат сообщений: JSON.
- Клиент отправляет объект вида:
	- `command` — имя команды.
	- `param` — строка или объект (для сложных параметров).
	- `username`/`password` — учетные данные пользователя.
- Для скриптов клиент отправляет заготовленные команды в виде txt фалйла, сервер обрабатывает их по очереди и возвращает массив ответов.

## Работа с БД
- Используется PostgreSQL.
- На старте сервер читает таблицу `People` и формирует коллекцию в памяти.
- Изменения коллекции сохраняются в БД через JDBC (INSERT/UPDATE/DELETE).
- Авторизация/регистрация обращается к таблице `users`.

## Авторизация и регистрация
- Выполняются на стороне клиента через JDBC.
- При регистрации создается соль, пароль хешируется SHA‑512, соль и хеш сохраняются в `users`.
- При входе пароль хешируется с сохраненной солью и сравнивается с сохраненным значением.

## Многопоточность
- Сервер принимает UDP‑пакеты в основном потоке и передает обработку в пул потоков (ExecutorService).
- Для защиты общей коллекции и критичных операций используется `ReadWriteLock`.
- Контекст запроса (например, `line`, `refactor`, `response`, `username/password`) хранится в ThreadLocal, чтобы запросы не мешали друг другу.

## Структуры данных и «массивы»
- `LinkedList<HumanBeing>` — основная коллекция на сервере. Плюсы: быстрые вставки/удаления в начале/конце, удобна для последовательного обхода.
- `LinkedTreeMap<String, Any?>` — представление объектов при JSON‑сериализации (Gson). Плюсы: удобное хранение вложенных структур без строгой схемы.
- `HashMap<String, Command>` — таблица команд. Плюсы: быстрый доступ по имени команды.
- `ByteArray` — буферы UDP‑пакетов. Плюсы: компактность и минимальные накладные расходы.
- `JsonArray` — пакетная отправка команд из скриптов.

## Быстрый запуск (кратко)
1. Поднимите PostgreSQL и создайте БД `mydatabase` с таблицей `People`.
2. Запустите сервер из модуля `Server-maven`.
3. Запустите клиент из модуля `Client-maven` и введите команды.
